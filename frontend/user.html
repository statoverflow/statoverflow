<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Stat Overflow - Top Users</title>
  <meta name="viewport" content="width=device-width">
  <title>Stat Overflow</title>
  <link rel="stylesheet" href="reset.css">
  <link rel="stylesheet" href="icomoon.css">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="desktop.css">
  <link rel="stylesheet" href="styleTopUser.css">

  <script id="top_users_table_template" type="text/x-handlebars-template">
      <tr>
        <td>{{ranking}}</td>
        <td>{{user_name}}</td>
        <td>{{reputation}}</td>
        <td>{{top_answer_rate}}</td>
        <td>{{location}}</td>
      </tr>
    </script>

</head>

<body>
  <header>
    <div class="logo" id="logo_container">
      <img class="logo" src="./images/logo.svg" alt="stat overflow logo" />
      <h1 class="logo">Stat Overflow</h1>
    </div>

    <nav>
      <a href="./index.html">
        <div id="questions_icon" class="icon-home"></div>
      </a>
      <a href="./user.html">
        <div id="users_icon" class="icon-trophy"></div>
      </a>
      <a href="./userlookup.html">
        <div id="userlookup_icon" class="icon-user"></div>
      </a>
      <a href="./sitestats.html">
        <div id="stats_icon" class="icon-stats-bars"></div>
      </a>
    </nav>
  </header>
  <main>
    <h2>Stack Overflow Top Contributors</h2>
    <div id="options_form_container">
      <label for="selected_language">
        <div>Programming Language</div>
        <select name="selected_language" id="selected_language">
          <option value="javascript">Javascript</option>
          <option value="c%23">C#</option>
          <option value="c++">C++</option>
          <option value="python">Python</option>
          <option value="java">Java</option>
        </select>
      </label>
      <label for="selected_time">
        <div>Time Range</div>
        <select name="selected_time" id="selected_time">
          <option value="all_time">All Time</option>
          <option value="month">Month</option>
        </select>
      </label>
    </div>
    <table id="resultTable">
      <thead>
        <tr>
          <th>Ranking</th>
          <th>Name</th>
          <th>Reputation</th>
          <th>Top Answer Rate</th>
          <th>Location</th>
        </tr>
      </thead>
      <tr>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
    </table>
  </main>
  <footer>
    <nav>
      <a href="https://github.com/statoverflow">
        <div class="icon-github"></div>
      </a>
    </nav>

    <p id="copyright_info">&copy; Stat Overflow development team (
      <a href="https://github.com/gricha2380">Gregor</a>,
      <a href="https://github.com/jpjazzy">Jeremy</a> and
      <a href="https://github.com/Jordanwvn">Jordan</a>)</p>
  </footer>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.min.js"></script>

  <script src="app.js"></script>

  <script>
    // event listener to monitor language menu & time frame menu. Send as header info to our API Endpoint.
    // take response and populate it into our table
    let __API_URL__ = 'http://localhost:3000';
    document.querySelector('#options_form_container').addEventListener('change', function (e) {
      populateAllUsers();
    });

    function populateAllUsers(){
      let time = document.querySelector('#selected_time').value;
      let lang = document.querySelector('#selected_language').value;
      // let sort = document.querySelector('#selected_sort').value;
      let sort = 'reputation';
      console.log(`language: ${lang}, time: ${time}`);
      $.ajax({
        url: `${__API_URL__}/api/v1/top-users/`,
        method: 'GET',
        data: {
          time: time,
          lang: lang
        }
      }).done(function (data) {
        console.log('I recieved something', data);
        let thead = `
        <thead>
          <tr>
            <th>Name</th>
            <th>Score</th>
            <th>Reputation</th>
            <th>Post Count</th>
            <th>Accept Rate</th>
          </tr>
        </thead>
        `;
        $('#resultTable').empty().append(thead);
        locations = [];
        data.forEach((x, i) => {
          let tr =
            `<tr>
              <td><span class='count'>${i + 1}</span><a href='${x.link}'>${x.user}</a></td>
              <td>${x.score}</td>
              <td>${x.reputation}</td>
              <td>${x.post_count}</td>
              <td>${x.accept_rate}</td>
            </tr>
            `
          $('#resultTable').append(tr);
        })
        // $('#resultTable').html(data);
      }).fail(function (xhr, status, error) {
        console.error(error, xhr);
      });
    }

    populateAllUsers();
  </script>
</body>

</html>