<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Stat Overflow - User Lookup</title>
    <link rel="stylesheet" href="reset.css">
    <link rel="stylesheet" href="icomoon.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="desktop.css">

    <!-- HANDLEBARS TEMPLATES -->
    <script id="user_results_template" type="text/x-handlebars-template">
      <div id="user_search_result">
        <img id="user_search_img" src="{{profile_picture_url}}" />
        <div id="user_search_container1">
          <h2 id="user_search_username"><a href="{{user_url}}">{{username}}</a></h2>
          <p id="user_search_rep">Reputation: {{reputation_pts}}</p>
        </div>
        <div id="user_search_container2">
          <p id="user_search_date_reg">Date registered: {{date_reg}}</p>
          <p id="user_search_date_accessed">Last Accessed: {{date_last_access}}</p>
        </div>
      </div>
    </script>

    <script id="user_recent_questions_template" type="text/x-handlebars-template">
      <div class="recent_search">
        <span>{{question_title}}</span>
        <span>{{question_date}}</span>
        <a href="{{question_url}}">View</a>
      </div>
    </script>

  </head>
  <body>
    <header>
      <div class="logo" id="logo_container">
        <img class="logo" src="./images/logo.svg" alt="stat overflow logo"/>
        <h1 class="logo">Stat Overflow</h1>
      </div>

      <nav>
        <a href="./index.html"><div id="questions_icon" class="icon-home"></div></a>
        <a href="./user.html"><div id="users_icon" class="icon-trophy"></div></a>
        <a href="./userlookup.html"><div id="userlookup_icon" class="icon-user"></div></a>
        <a href="./sitestats.html"><div id="stats_icon" class="icon-stats-bars"></div></a>
      </nav>
    </header>
    <main>
      <h1>Look up stack overflow user</h1>

      <form id="user_search_container">
        <label for="search_user">
          <input type="text" name="search_user" id="search_user" placeholder="Username">
          <button name="search_user_button" id="search_user_button"><div class="icon-search"></div></button>
        </label>
      </form>

      <div id="user_search_result">
        <img id="user_search_img" src="http://placehold.it/100x100" />
        <div id="user_search_container1">
          <h2 id="user_search_username"><a href="index.html">Username</a></h2>
          <p id="user_search_rep">Reputation: #######</p>
        </div>
        <div id="user_search_container2">
          <p id="user_search_date_reg">Date registered: ##-##-####</p>
          <p id="user_search_date_accessed">Last Accessed: ##-##-####</p>
        </div>
      </div>

      <section id="user_search_recent">
        <h2>Recent Questions</h2>
        <div class="recent_search">
          <span>Question goes here.. hfhds s hds fsdhf hsdfhds hfsd </span>
          <span>##-##-####</span>
          <a href="#">View</a>
        </div>
        <div class="recent_search">
          <span>Question goes here.. hfhds s hds fsdhf hsdfhds hfsd </span>
          <span>##-##-####</span>
          <a href="#">View</a>
        </div>
        <div class="recent_search">
          <span>Question goes here.. hfhds s hds fsdhf hsdfhds hfsd </span>
          <span>##-##-####</span>
          <a href="#">View</a>
        </div>
        <div class="recent_search">
          <span>Question goes here.. hfhds s hds fsdhf hsdfhds hfsd </span>
          <span>##-##-####</span>
          <a href="#">View</a>
        </div>
        <div class="recent_search">
          <span>Question goes here.. hfhds s hds fsdhf hsdfhds hfsd </span>
          <span>##-##-####</span>
          <a href="#">View</a>
        </div>
      </section>

      <div id="user_search_map_container">
        <p id="user_search_map_location"><b>Location: </b> City, Country</p>
        <img id="user_search_map" src="http://placehold.it/1000x400" />
      </div>

    </main>
    <footer>
      <nav>
        <a href="https://github.com/statoverflow"><div class="icon-github"></div></a>
      </nav>

      <p id="copyright_info">&copy; Stat Overflow development team (<a href="https://github.com/gricha2380">Gregor</a>, <a href="https://github.com/jpjazzy">Jeremy</a> and <a href="https://github.com/Jordanwvn">Jordan</a>)</p>
    </footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.min.js"></script>
    <script src="app.js"></script>
    <script>
      let __API_URL__ = 'http://localhost:3000';
      document.querySelector('#search_user_button').addEventListener('click', function (e) {
        if (document.querySelector('#search_user').value !=='') {
          searchUsers();
        }
      });

      function searchUsers(){
        let username = document.querySelector('#search_user').value;
        console.log(`language: ${username}`);
        $.ajax({
          url: `${__API_URL__}/api/v1/users/`,
          method: 'GET',
          data: {
            search: name
          }
        }).done(function (data) {
          console.log('I recieved something', data);
          let thead = `
          <thead>
            <tr>
              <th>Name</th>
              <th>Score</th>
              <th>Reputation</th>
              <th>Post Count</th>
              <th>Accept Rate</th>
            </tr>
          </thead>
          `;
          $('#user_search_recent').empty().append(thead);
          locations = [];
          data.forEach((x, i) => {
            let box =
              `<div class="recent_search">
                <span><span class='count'>${i + 1}</span><a href='${x.link}'>${x.user}</a></span>
                <span>${x.score}</span>
                <span>${x.reputation}</span>
                <span>${x.post_count}</span>
                <span>${x.accept_rate}</span>
              </tr>
              `
            $('#user_search_result').append(box);
          })
        }).fail(function (xhr, status, error) {
          console.error(error, xhr);
        });
      }
    </script>
  </body>
</html>
